<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Freezy Global</title>
<link rel="stylesheet" href="style.css">
<script src="products.js"></script>
<script src="cart.js"></script>
</head>
<body>
<header>
<h1>Admin Panel</h1>
<nav>
<a href="index.html">Home</a>
<a href="services.html">Services</a>
<a href="products.html">Products</a>
<a href="cart.html">Cart</a>
<a href="admin.html">Admin</a>
</nav>
</header>

<section>
<h2>Admin Login</h2>
<input type="password" id="adminPasswordInput" placeholder="Enter password">
<button onclick="loginAdmin()">Login</button>

<div id="adminPanel">
<h2>Manage Products/Services</h2>
<div id="productList"></div>

<h3>Add / Edit Product/Service</h3>
<input type="text" id="newName" placeholder="Name">
<input type="number" id="newPrice" placeholder="Price">
<select id="newType">
  <option value="product">Product</option>
  <option value="service">Service</option>
</select>
<input type="file" id="newImg">
<button onclick="addOrUpdateProduct()">Save</button>

<h3>Orders</h3>
<div id="orderList"></div>
</div>

<script>
// Secure password in sessionStorage
const defaultPass = "admin123";
if(!sessionStorage.getItem("adminPass")) sessionStorage.setItem("adminPass",defaultPass);

function loginAdmin(){
  const input = document.getElementById("adminPasswordInput").value;
  if(input===sessionStorage.getItem("adminPass")){
    document.getElementById("adminPanel").style.display="block";
    renderProductList();
    renderOrders();
  } else alert("Wrong password!");
}

let editId = null; // null = add, number = edit

function addOrUpdateProduct(){
  const name = document.getElementById("newName").value;
  const price = parseInt(document.getElementById("newPrice").value);
  const type = document.getElementById("newType").value;
  const fileInput = document.getElementById("newImg");
  
  if(!name || !price) { alert("Enter name and price"); return; }
  
  if(fileInput.files && fileInput.files[0]){
    const reader = new FileReader();
    reader.onload = function(e){
      const imgData = e.target.result;
      saveProduct(name, price, type, imgData);
    }
    reader.readAsDataURL(fileInput.files[0]);
  } else {
    const imgData = editId ? products.find(p=>p.id===editId).img : "https://via.placeholder.com/250x150";
    saveProduct(name, price, type, imgData);
  }
}

function saveProduct(name, price, type, imgData){
  if(editId){ // update
    const p = products.find(p=>p.id===editId);
    p.name=name; p.price=price; p.type=type; p.img=imgData;
    editId=null;
  } else { // add new
    const id = Math.max(...products.map(p=>p.id))+1;
    products.push({id,name,price,type,img:imgData});
  }
  renderProductList();
  clearForm();
}

function clearForm(){
  document.getElementById("newName").value="";
  document.getElementById("newPrice").value="";
  document.getElementById("newType").value="product";
  document.getElementById("newImg").value="";
}

function renderProductList(){
  const list = document.getElementById("productList");
  list.innerHTML="";
  products.forEach(p=>{
    const div = document.createElement("div");
    div.className="card";
    div.innerHTML=`<img src="${p.img}" width="150">
      ${p.name} - ₦${p.price} (${p.type}) 
      <button onclick="editProduct(${p.id})">Edit</button>
      <button onclick="removeProduct(${p.id})">Remove</button>`;
    list.appendChild(div);
  });
}

function editProduct(id){
  const p = products.find(p=>p.id===id);
  document.getElementById("newName").value=p.name;
  document.getElementById("newPrice").value=p.price;
  document.getElementById("newType").value=p.type;
  editId=id;
}

function removeProduct(id){
  const index = products.findIndex(p=>p.id===id);
  if(index>-1){ products.splice(index,1); renderProductList(); }
}

// Orders from localStorage (paid only)
function renderOrders(){
  const orders = JSON.parse(localStorage.getItem("orders"))||[];
  const container = document.getElementById("orderList");
  container.innerHTML="";
  if(orders.length===0){ container.textContent="No orders yet"; return; }
  orders.forEach(o=>{
    const div = document.createElement("div");
    div.textContent=`Order Ref: ${o.reference}, Amount: ₦${o.amount/100}`;
    container.appendChild(div);
  });
}
</script>
</section>
</body>
</html>
