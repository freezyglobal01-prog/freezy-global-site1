<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout - Freezy Global</title>
<link rel="stylesheet" href="style.css">
<style>
body{font-family:Arial,sans-serif;background:#f5f5f5;margin:0;padding:0;}
header{background:#000;color:#FFD700;padding:20px;text-align:center;}
section{max-width:900px;margin:30px auto;background:#fff;padding:30px;border-radius:10px;box-shadow:0 0 20px rgba(0,0,0,0.2);}
input,select{width:100%;padding:12px;margin:10px 0;border-radius:5px;border:1px solid #ccc;}
button{width:100%;padding:15px;margin-top:10px;border:none;background:#FFD700;color:#000;font-weight:bold;border-radius:5px;cursor:pointer;}
button:hover{background:#e6c200;}
</style>
<script src="cart.js"></script>
</head>
<body>
<script>
const user=JSON.parse(localStorage.getItem("loggedInUser"));if(!user){window.location.href="login.html";}
</script>

<header>
<img src="logo.png" alt="Logo" style="width:100px;">
<h1>Checkout</h1>
</header>

<section>
<h2>Delivery & Contact Info</h2>
<input type="text" id="name" placeholder="Full Name">
<input type="text" id="phone" placeholder="Phone Number">
<input type="email" id="email" placeholder="Email Address">
<input type="text" id="address" placeholder="House Address">
<select id="state" onchange="updateDeliveryFee()">
<option value="">Select State</option>
<option value="Edo">Edo State - ₦2000</option>
<option value="Other">Other State - ₦5000</option>
<option value="Pickup">Pickup - ₦0</option>
</select>

<h3>Order Summary</h3>
<div id="checkoutItems"></div>
<p>Total Products: ₦<span id="totalProducts">0</span></p>
<p>Delivery Fee: ₦<span id="deliveryFee">0</span></p>
<p><strong>Total Amount: ₦<span id="finalTotal">0</span></strong></p>

<button onclick="placeOrder()">Place Order</button>
</section>

<script>
let deliveryFee=0;
const cartItems=JSON.parse(localStorage.getItem("cart"))||[];

function updateCheckoutSummary(){
  const container=document.getElementById("checkoutItems");
  container.innerHTML="";
  let total=0;
  cartItems.forEach(item=>{
    const subtotal=item.price*item.qty;
    total+=subtotal;
    const div=document.createElement("div");
    div.innerHTML=`${item.name} x ${item.qty} = ₦${subtotal}`;
    container.appendChild(div);
  });
  document.getElementById("totalProducts").innerText=total;
  document.getElementById("deliveryFee").innerText=deliveryFee;
  document.getElementById("finalTotal").innerText=total+deliveryFee;
}

function updateDeliveryFee(){
  const state=document.getElementById("state").value;
  if(state==="Edo") deliveryFee=2000;
  else if(state==="Other") deliveryFee=5000;
  else if(state==="Pickup") deliveryFee=0;
  updateCheckoutSummary();
}

function placeOrder(){
  const name=document.getElementById("name").value;
  const phone=document.getElementById("phone").value;
  const email=document.getElementById("email").value;
  const address=document.getElementById("address").value;
  const state=document.getElementById("state").value;
  if(!name||!phone||!email||!address||!state) return alert("Please fill all fields");

  const order={customer:{name,phone,email,address,state},items:cartItems,deliveryFee,total:cartItems.reduce((a,b)=>a+b.price*b.qty,0)+deliveryFee,date:new Date().toLocaleString()};
  const orders=JSON.parse(localStorage.getItem("orders"))||[];
  orders.push(order);
  localStorage.setItem("orders",JSON.stringify(orders));
  localStorage.removeItem("cart");
  alert("Order placed successfully!");
  window.location.href="thankyou.html";
}

updateCheckoutSummary();
</script>
</body>
</html><header>
<h1>Freezy Global Checkout</h1>
<nav>
<a href="index.html">Home</a> | 
<a href="services.html">Services</a> | 
<a href="products.html">Products</a> | 
<a href="cart.html">Cart</a> | 
<a href="admin.html">Admin</a>
</nav>
</header>

<section>
<!-- Left: Customer Info -->
<div class="checkout-left">
<h2>Customer Details</h2>
<input type="text" id="customerName" placeholder="Your Name">
<input type="email" id="customerEmail" placeholder="Your Email">
<button id="payButton">Pay Now</button>
</div>

<!-- Right: Order Summary -->
<div class="checkout-right">
<h2>Order Summary</h2>
<div id="checkoutItems"></div>
<p class="total">Total: ₦<span id="checkoutTotal">0</span></p>
</div>
</section>

<script src="https://js.paystack.co/v1/inline.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const cartItems = JSON.parse(localStorage.getItem("cart")) || [];
  const container = document.getElementById("checkoutItems");
  let total = 0;

  cartItems.forEach(item => {
    const subtotal = item.price * item.qty;
    total += subtotal;
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `<span>${item.name} x ${item.qty}</span><span>₦${subtotal}</span>`;
    container.appendChild(div);
  });

  document.getElementById("checkoutTotal").textContent = total;

  document.getElementById("payButton").addEventListener("click", () => {
    const name = document.getElementById("customerName").value;
    const email = document.getElementById("customerEmail").value;

    if (!name || !email) { alert("Please enter your name and email"); return; }

    let handler = PaystackPop.setup({
      key: "YOUR_PUBLIC_KEY", // Replace with your Paystack public key
      email: email,
      amount: total * 100,
      currency: "NGN",
      metadata: { custom_fields: [{ display_name:"Name", variable_name:"name", value:name }] },
      callback: function(response){
        const order = { reference: response.reference, amount: total, items: cartItems, customer: { name, email }, date:new Date().toLocaleString() };
        localStorage.setItem("lastOrder", JSON.stringify(order));

        const orders = JSON.parse(localStorage.getItem("orders")) || [];
        orders.push(order);
        localStorage.setItem("orders", JSON.stringify(orders));

        clearCart();
        window.location.href = "thankyou.html";
      },
      onClose: function(){ alert("Payment window closed"); }
    });
    handler.openIframe();
  });
});
</script>
</body>
</html>
